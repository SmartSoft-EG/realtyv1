<!-- Posts -->

<template>
    <div class="animate-bounce">test</div><svg class="mt-4" id="svg5" viewBox="0 0 1280 800" version="1.1">
        <g id="layer1" inkscape:label="Layer 1" inkscape:groupmode="layer">
            <g id="8" :ref="el => { gps[el.id] = el }">
                <path id="8_gi" :ref="el => { paths[el.id] = el }"
                    d="m 535.00137,114.57175 c -4.31051,24.22399 -7.37881,70.35362 -0.65935,74.19332 6.71946,3.83969 34.73662,-25.7172 34.73662,-25.7172 0,0 22.07823,29.27765 36.95704,24.95799 14.87881,-4.31965 -6.71946,-83.5133 -6.71946,-83.5133 0,0 -19.2309,-9.572317 -31.67746,-7.199427 -12.44657,2.3729 -30.39196,4.659877 -32.63739,17.278617 z"
                    sodipodi:nodetypes="sccscss"></path>
                <path id="8_t" :ref="el => { paths[el.id] = el }"
                    d="m 603.74202,165.71532 -10,-58.00311 c 0,0 -10.4,-94.796124 -34.9,-94.25505 -17.4,1.298577 -17.8,141.86955 -19.9,153.9896 m 64.8,-1.73144 c 12.2,32.78908 14.3,73.04497 10.4,83.65001 -2.7,7.57504 -79.7,1.51501 -79.7,1.51501 0,0 -3.6,-12.33648 -2.4,-30.0837 1.2,-17.74722 0.8,-44.90913 7.9,-57.57025 7.1,-12.66113 51.5,-30.30014 63.8,2.48893 z">
                </path>
                <path id="8_m2" :ref="el => { paths[el.id] = el }"
                    d="m 611.57987,194.13903 -18.96575,1.12608 1.49069,27.9051 20.80035,-1.32756"></path>
                <path id="8_en" :ref="el => { paths[el.id] = el }"
                    d="m 581.34202,148.34488 c 0,0 -13.4,-135.320579 -21.2,-134.88772 -7.9,0.432859 -1.2,137.43274 -1.2,137.43274">
                </path>
                <path id="8_po" :ref="el => { paths[el.id] = el }"
                    d="m 555.32231,205.06281 -3.53683,-40.80167 -6.94475,-6.57914 10.88132,-8.39945 -0.26573,-22.30626 5.30529,-5.8294 -6.20524,-8.34359 4.15811,-6.4813 -3.52229,-6.655967 4.86484,-7.61214 -4.9461,-7.19604 5.10731,-6.12125 -4.48923,-10.01762 8.13756,-15.256839 10.21696,15.579269 -2.91007,7.32908 4.21342,7.62743 -2.41695,8.00872 4.18007,6.72814 -3.16074,8.140337 5.03212,6.99224 -5.29048,6.22909 5.89979,5.15403 1.88461,20.53627 11.74109,6.20731 -5.76587,8.55107 2.68717,42.80277 z">
                </path>
                <path id="8_or" :ref="el => { paths[el.id] = el }"
                    d="m 532.28625,203.782 81.27273,-2.4 m -33.38182,12.5 0.10909,-7.7 -5.23636,0.1 0.10909,-8.6 5.45454,0.1 0.76364,-9.7 -16.36364,0.5 0.21818,8.8 5.23637,0.1 0.10909,9.1 -5.12727,0.3 0.10909,7.2 c 5.01818,0.9 9.49091,0.2 14.61818,-0.2 z">
                </path>
                <path id="8_im" :ref="el => { paths[el.id] = el }"
                    d="m 572.68382,67.882003 h -12.16389 l 0.076,50.599997 12.62003,0.4 z M 550.1046,123.882 l 35.27528,-1.6 m -32.46238,-13.6 30.25767,-1.4 m -30.25767,-14.799997 27.44478,-1.7 m -24.63188,-17.4 22.57922,-0.9 m -18.778,-17 h 16.72534 M 557.70703,206.982 l -2.5088,-38.2 -4.56146,-9.1 c 0,-13.3 -0.98831,-22.6 -0.53217,-35.8 l -3.26904,-10.7 6.08194,-4.6 -4.56145,-9.099997 4.56145,-7.1 -3.04097,-13.7 5.85387,-5.4 -3.57314,-11.6 7.37436,-6.2 -3.57314,-7.5 12.46798,-14.5 11.40365,13.7 -3.57315,8.3 5.85387,6.2 -3.80121,10.7 5.85387,7.4 -3.80121,10.8 5.16965,6.3 -2.35676,10.199997 4.86556,5.7 -2.66085,9.4 c 0,0 0.3041,20.7 0.98832,34 l -4.48544,14.3 -1.59651,35.7 z">
                </path>
                <path id="8_fl" :ref="el => { paths[el.id] = el }"
                    d="m 572.72264,186.19148 c 21.68079,-0.27707 45.82616,-11.48351 42.85748,-45.55213 l -85.96634,3.51237 c 2.14857,23.45072 15.84565,42.36919 43.10886,42.03976 z">
                </path>
                <path id="8_m1" :ref="el => { paths[el.id] = el }"
                    d="m 594.10481,223.17021 -0.66694,29.65013 c 7.14063,-0.23831 13.55371,-1.20418 19.93398,-2.20285 0,0 3.98511,-16.72435 1.53331,-28.77484 -2.16085,0.38787 -20.80035,1.32756 -20.80035,1.32756 z">
                </path>
                <path id="8_d1" :ref="el => { paths[el.id] = el }"
                    d="m 534.442,250.88034 19.61749,0.70557 -1.44015,-29.62604 -20.57364,0.61721 c 0,0 -0.76225,23.68869 2.3963,28.30326 z">
                </path>
                <path id="8_d2" :ref="el => { paths[el.id] = el }"
                    d="m 532.04568,222.57708 c 0,0 22.21954,2.46883 20.57364,-0.61721 -0.22599,-2.23413 -0.31001,-28.0692 -0.26598,-25.68604 l -19.04827,-0.1954 z">
                </path>
                <path id="8_c1" :ref="el => { paths[el.id] = el }"
                    d="m 558.99439,159.2986 c 0,0 -2.90954,4.21886 -1.3093,7.12841 1.60027,2.90956 25.31312,1.89121 25.45859,0.29095 4.03738,-2.32999 1.92313,-9.43475 -3.05502,-8.87413 -2.76407,0.14547 -21.09427,1.45477 -21.09427,1.45477 z">
                </path>
                <path id="8_cr" :ref="el => { paths[el.id] = el }"
                    d="m 603.74202,165.71532 c 12.2,32.78908 14.3,73.04497 10.4,83.65001 -2.7,7.57504 -79.7,1.51501 -79.7,1.51501 0,0 -3.6,-12.33648 -2.4,-30.0837 1.2,-17.74722 0.8,-44.90913 7.9,-57.57025 7.1,-12.66113 51.5,-30.30014 63.8,2.48893 z">
                </path>
            </g>
            <g id="7" :ref="el => { gps[el.id] = el }">
                <path id="7_gi" :ref="el => { paths[el.id] = el }"
                    d="m 470.96681,166.9922 1.98126,-51.89507 -5.94377,18.80693 -1.82275,45.65962 c 1.585,-5.22973 3.17001,-10.76119 5.78526,-12.57148 z m 45.64816,-0.80457 c -1.66425,-16.29264 -2.77377,-32.58528 -3.56627,-48.87792 l 5.62678,11.86748 2.61525,50.78878 z">
                </path>
                <path id="7_t" :ref="el => { paths[el.id] = el }"
                    d="m 518.62539,166.95081 c 0,0 -14.5,-142.699994 -32.8,-143.199994 -17,-0.4 -12.9,116.199994 -17,141.899994 m -9.5,56.1 c 0,0 -2.5,19.1 9.1,22 11.6,2.9 55.6,4.1 55.6,4.1 0,0 6.2,-2.9 5.4,-17 -0.8,-14.1 1.2,-85.9 -37.3,-81.7 -17.5,3.7 -29.1,4.1 -32.8,72.6 z">
                </path>
                <path id="7_en" :ref="el => { paths[el.id] = el }"
                    d="m 502.82539,150.75081 c 0,0 -10.4,-126.599994 -16.6,-126.599994 -6.2,0 -4.1,127.399994 -4.1,127.399994">
                </path>
                <path id="7_po" :ref="el => { paths[el.id] = el }"
                    d="m 482.29044,199.88412 -2.89727,-28.85064 -6.0587,-11.83097 10.79092,-7.6517 -0.50376,-14.82371 4.61999,-5.17832 -4.93321,-7.95242 3.68033,-5.82561 -2.74067,-6.28796 4.30677,-6.84278 -5.98233,-6.620877 4.83921,-6.78718 -4.385,-9.43193 8.03403,-11.11511 8.62915,9.46935 -1.34695,10.43031 3.28881,7.21265 -3.21042,5.973677 4.22838,7.71189 -2.89727,7.3976 3.99354,6.65784 -4.61999,5.5482 4.7766,4.99338 2.69604,15.12569 c 4.90799,2.01403 9.00201,4.72574 10.75989,9.43985 l -7.97458,8.35379 -0.73072,30.97843 z">
                </path>
                <path id="7_or" :ref="el => { paths[el.id] = el }"
                    d="m 461.92921,205.47181 69.60462,-2.4 m -28.58928,12.5 0.0934,-7.7 -4.48459,0.1 0.0934,-8.6 4.67145,0.1 0.654,-9.7 -14.01435,0.5 0.18686,8.8 4.48459,0.1 0.0934,9.1 -4.39117,0.3 0.0934,7.2 c 4.29774,0.9 8.12833,0.2 12.51949,-0.2 z">
                </path>
                <path id="7_im" :ref="el => { paths[el.id] = el }"
                    d="M 495.21566,74.538233 H 483.8417 l 0.0711,50.599997 11.80048,0.4 z m -21.11292,55.999997 32.9845,-1.6 m -30.35427,-13.6 28.29274,-1.4 m -28.29274,-14.799997 25.66251,-1.7 m -23.03228,-17.4 21.11292,-0.9 M 482.91756,62.138236 h 15.6392 m -17.34529,151.499994 -2.34588,-38.2 -4.26524,-9.1 c 0,-13.3 -0.92413,-22.6 -0.49761,-35.8 l -3.05675,-10.7 5.68698,-4.6 -4.26523,-9.1 4.26523,-7.099997 -2.84349,-13.7 5.47372,-5.4 -3.3411,-11.6 6.89546,-6.199997 -3.3411,-7.5 11.65832,-14.5 10.66309,13.7 -3.34111,8.3 5.47372,6.199997 -3.55436,10.7 5.47372,7.4 -3.55436,10.8 4.83393,6.299997 -2.2037,10.2 4.54958,5.7 -2.48805,9.4 c 0,0 0.28435,20.7 0.92413,34 l -4.19415,14.3 -1.49283,35.7 z">
                </path>
                <path id="7_fl" :ref="el => { paths[el.id] = el }"
                    d="m 495.2563,184.70385 c 21.68079,-0.27707 37.32616,-6.48351 34.35748,-40.55213 l -72.71634,2.76237 c 2.14857,23.45072 11.09565,38.11919 38.35886,37.78976 z">
                </path>
                <path id="7_m1" :ref="el => { paths[el.id] = el }"
                    d="m 509.82538,220.05081 -1.60265,26.96046 15.80266,0.83954 c 0,0 8.25134,-8.68276 5.06773,-27.29103 -4.02724,-0.91293 -19.26774,-0.50897 -19.26774,-0.50897 z">
                </path>
                <path id="7_m2" :ref="el => { paths[el.id] = el }"
                    d="m 527.23686,196.07702 -16.23728,0.18563 -1.1742,23.78816 19.26774,0.50897"></path>
                <path id="7_d1" :ref="el => { paths[el.id] = el }"
                    d="m 459.72931,216.40498 16.9526,0.41148 0.41147,28.21084 c 0,0 -11.60343,0.798 -16.64399,-8.76876 -1.54302,-5.34914 -0.72008,-19.85356 -0.72008,-19.85356 z">
                </path>
                <path id="7_d2" :ref="el => { paths[el.id] = el }"
                    d="m 459.72932,216.40498 16.95259,0.41148 -0.60688,-22.66329 -14.28835,-0.0706 z"></path>
                <path id="7_c1" :ref="el => { paths[el.id] = el }"
                    d="m 483.05506,159.00766 c -1.23552,0.26932 -1.02137,4.6161 -0.14546,5.52814 4.55865,4.74671 22.37406,1.89632 24.87667,0.14549 1.45477,-3.63695 -0.87287,-5.52816 -4.07339,-6.25555 -3.15828,-0.6218 -14.32183,-0.79922 -20.65782,0.58192 z">
                </path>
                <path id="7_cr" :ref="el => { paths[el.id] = el }"
                    d="m 459.32539,221.75081 c 0,0 -2.5,19.1 9.1,22 11.6,2.9 55.6,4.1 55.6,4.1 0,0 6.2,-2.9 5.4,-17 -0.8,-14.1 1.2,-85.9 -37.3,-81.7 -17.5,3.7 -29.1,4.1 -32.8,72.6 z">
                </path>
            </g>
        </g>
    </svg>
</template>
<script setup lang="ts">
import { ref, onMounted } from 'vue'

interface Style {
    fill?: string,
    stroke?: string,
    opacity?: number,
    parts?: [],
}
const base_style: Style = {
    fill: 'transparent',
    stroke: 'transparent',
    parts: []

}


class part {

    id: string;
    type: string;
    element: SVGPathElement;
    private _style: Style = {};
    private _selcted_style: Style = {}


    constructor(id: string, type: string) {
        this.id = id;
        this.type = type;
        this.element = paths.value[id]
        this.style = base_style;
    }

    public get style() {
        return this._style
    }

    public set style(val) {
        this.selected_style = val
        this._style = val
    }

    public get selected_style() {
        return this._selcted_style
    }

    public set selected_style(val) {
        if (!this.element) return
        this.element.style.fill = val?.fill || 'transparent'
        this.element.style.stroke = val?.stroke || 'transparent'
        this._selcted_style = val
    }



    reset() {
        this.element?.setAttribute('style', 'fill:transparent;stroke:transparent');
        // this.element.setAttribute("class", this.type + "-base");
    }

    setClass(css: string) {
        this.element.setAttribute("class", css);
    }
    setStyle(style: any) {
        this.element.style.fill = style.fill;
        this.element.style.opacity = style.opacity;
        this.element.style.strokeWidth = style.border_width;
        this.element.style.stroke = style.border_color;
    }
    setStyleInline(style: string) {
        this.element.setAttribute("style", style);
    }

    addCssClass(css: string) {
        this.element.classList.add(css);
    }

    removeCssClass(css: string) {
        this.element.classList.remove(css);
    }
}


class tooth {
    id: number;
    parts: { [key: string]: part } = {};
    body: part
    private _selected: boolean = false;
    position?: string;
    quadrent?: string;
    quad_num: string;
    gr: SVGGElement;
    constructor(id: number) {
        this.id = id
        this.gr = gps.value[this.id]
        this.body = new part(this.id + "_t", "body");
        this.parts.crown = new part(this.id + "_cr", "part");
        this.parts.flange = new part(this.id + "_fl", "part");
        this.parts.mesial = new part(this.id + "_m1", "part");
        this.parts.sub_mesial = new part(this.id + "_m2", "part");
        this.parts.distal = new part(this.id + "_d1", "part");
        this.parts.sub_distal = new part(this.id + "_d2", "part");
        this.parts.cervical = new part(this.id + "_c1", "part");
        this.parts.canal = new part(this.id + "_en", "part");
        this.parts.ortho = new part(this.id + "_or", "part");
        this.parts.perio = new part(this.id + "_gi", "part");
        this.parts.implant = new part(this.id + "_im", "part");
        this.parts.post = new part(this.id + "_po", "part");
        this.parts.state = new part(this.id + "_state", "state");

        this.body.element.setAttribute('style', 'fill:white;stroke:red');

        //parts for posterior only
        if (this.id < 6 || (this.id > 11 && this.id < 22) || this.id > 27) {
            this.parts.occlusal = new part(this.id + "_o1", "part");
            this.parts.sub_occlusal = new part(this.id + "_o2", "part");
        }




        //set position
        if (this.id < 6 || (this.id > 11 && this.id < 22) || this.id > 27)
            this.position = "anterior";


        //set quadrents

        // if ([1, 2, 3, 4, 5, 6, 7, 8].includes(this.id)) this.quadrent = "UR";
        // else if ([9, 10, 11, 12, 13, 14, 15, 16].includes(this.id)) this.quadrent = "UL";
        // else if ([17, 18, 19, 20, 21, 22, 23, 24].includes(this.id)) this.quadrent = "LL";
        // else if ([25, 26, 27, 28, 29, 30, 31, 32].includes(this.id)) this.quadrent = "LR";

        if (this.id < 9) this.quadrent = "UR";
        else if (this.id > 8 && this.id < 17) this.quadrent = "UL";
        else if (this.id > 16 && this.id < 25) this.quadrent = "LL";
        else if (this.id > 24 && this.id < 33) this.quadrent = "LR";

        //quad num

        if (this.id < 9) this.quad_num = "UR " + (9 - id);
        else if (this.id > 8 && this.id < 17) this.quad_num = "UL " + (id - 8);
        else if (this.id > 16 && this.id < 25) this.quad_num = "LL " + (25 - id);
        else this.quad_num = "LR " + (id - 24);




        this.gr.addEventListener(
            "mouseenter", () => this.enter())

        this.gr.addEventListener(
            "mouseleave", () => this.leave())

        this.gr.addEventListener(
            "click", () => this.click())
    }

    click() {
        this.selected = !this.selected
    }


    enter() {
        this.body.element.style.strokeWidth = '2'

    }

    leave() {
        this.body.element.style.strokeWidth = '1'

    }


    public get selected() {
        return this._selected
    }

    public set selected(val: boolean) {
        if (val) {
            this.body.element.style.fill = 'yellow'


            props.active_style?.styles.forEach(s => {
                s.parts.forEach(p => this.parts[p].selected_style = s)

            })

            _selection.value.push(this.id)
            //   this.addStyle()
        }

        else {
            Object.keys(this.parts).forEach(k => this.parts[k].selected_style = this.parts[k].style);

            this.body.element.style.fill = 'white'
            _selection.value = _selection.value.filter(s => s !== this.id)
        }
        this._selected = val
        if (emt) emit('update:selection', _selection.value)
    }

    addStyle() {
        style.parts.forEach(p => {
            this.parts[p].setStyleInline(style.style)

        })
    }





}

interface Jaw {
    teeth: any
}


const paths = ref<{ [key: string]: SVGPathElement }>({})
const gps = ref<{ [key: string]: SVGGElement }>({})
const _selection = ref<Number[]>([])

const jaw = ref<Jaw>({ teeth: {} })

const emit = defineEmits(['update:selection'])

const props = defineProps({
    selection: Array,
    active_style: Object
})

let emt = true

function getTooth(id: number) {
    return jaw.value.teeth[id]
}

const style = {
    parts: ['mesial', 'sub_mesial', 'distal'],
    style: 'fill:blue;stroke:blue'
}

watch(() => props.selection, (val) => {
    emt = false
    getTooth(7).selected = false
    getTooth(8).selected = false

    val?.forEach(v => {
        getTooth(v).selected = true
    })
    emt = true
});

onMounted(() => {

    jaw.value.teeth[8] = new tooth(8)
    jaw.value.teeth[7] = new tooth(7)

})

</script>

<style>
.bg-red {
    fill: aqua
}

.test {
    fill: aqua
}
</style>
